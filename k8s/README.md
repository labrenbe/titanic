# Deployment to Kubernetes
This project utilizes [ArgoCD](https://argo-cd.readthedocs.io/en/stable/) for GitOps and to bootstrap new clusters.

## Components
- ArgoCD 2.5.5
- Titanic API 0.2.0
- Postgres 15.1
- Prometheus 43.2.1
- Prometheus Operator 0.61.1
- Grafana 6.48.2
- Istio 1.16.1
- Carvel Secretgen Controller 0.13.0

## Bootstrapping
To bootstrap the project in a new cluster for which you have a valid kubeconfig run:
```
sh ./bootstrap.sh
```
This will first install ArgoCD and then setup an [app of apps pattern](https://argo-cd.readthedocs.io/en/stable/operator-manual/cluster-bootstrapping/#app-of-apps-pattern) to deploy all other components. ArgoCD will then continuously reconcile the applications to ensure they are in sync with the configuration in this repo. 

## Resources
ArgoCD and Istio can take up quite alot of computing resources, so this project might not run on every cluster (Minikube etc.).
You can adjust ArgoCD's resources with kustomize in the argocd/kustomize/ subdirectory. 
Resource usage for Istio can't be adjusted as the source of truth for configuration is this gitlab repo.

## Ingress
There is currently no ingress, because development was done on a GKE private cluster with no load balancer. Service can be accessed by port-forwarding.

## Postgres password
A secret for the postgres password is generated by the secretgen-controller and then mounted by the titanic pods. The postgres helm chart is configured to use this as an existing secret to initialize the database.
